<!doctype html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8"/>
    <title>사진으로 기록하기 | Culture Archive</title>
    <link rel="stylesheet" th:href="@{/css/bootstrap.min.css}"/>
    <style>
        :root{--r:16px; --ink:#0f172a; --muted:#6b7280; --brand:#3a75e6; --bg:#f5f8ff;}
        body{background:linear-gradient(180deg,var(--bg),#fff 60%)}
        .page{max-width:920px;margin:0 auto;padding:40px 16px}
        .hero{border-radius:var(--r); padding:28px; background:#fff; box-shadow:0 18px 60px rgba(15,23,42,.08)}
        .hero h2{font-weight:800; letter-spacing:-.2px; color:var(--ink); margin:0 0 6px}
        .hero p{color:var(--muted); margin:0}
        .drop{margin-top:18px; border:1.5px dashed #c7d2fe; border-radius:20px; background:#fafbff;
              padding:28px; text-align:center; transition:.2s}
        .drop:hover{background:#f3f6ff}
        .drop .icon{width:52px;height:52px; margin:0 auto 10px; opacity:.8}
        .drop .hint{color:var(--muted); font-size:.95rem}
        .preview{display:none; margin-top:16px; gap:16px; align-items:center; justify-content:center}
        .preview img{width:160px; height:230px; object-fit:cover; border-radius:12px; border:1px solid #e5e7eb}
        .actions{display:flex; gap:10px; justify-content:center; margin-top:16px}
        .actions .btn-lg{padding:.65rem 1.1rem}
    </style>
</head>
<body>
<div th:replace="~{fragments/header :: header}"></div>

<div class="page">
    <div class="hero">
        <div class="d-flex flex-column flex-md-row align-items-md-center justify-content-between">
            <div class="mb-3 mb-md-0">
                <h2>사진으로 기록하기</h2>
                <p>티켓·포스터를 올리면 이벤트를 찾아드립니다.</p>
            </div>
        </div>

        <form class="mt-3" th:action="@{/ocr/process}" method="post" enctype="multipart/form-data">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>

            <label class="drop w-100" for="imageFile">
                <svg class="icon" viewBox="0 0 24 24" fill="none">
                    <path d="M12 16l-4-4m4 4l4-4m-4 4V4" stroke="#3a75e6" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
                    <rect x="3" y="14" width="18" height="6" rx="2" stroke="#94a3b8" stroke-width="1.2"/>
                </svg>
                <div class="mb-1 fw-semibold">이미지 드래그 앤 드롭 또는 파일 선택</div>
                <div class="hint">JPG, PNG 등 이미지 파일 지원</div>
                <input id="imageFile" name="imageFile" type="file" accept="image/*" class="visually-hidden" required>
            </label>

            <div id="preview" class="preview">
                <img id="previewImg" alt="미리보기">
                <div class="text-center">
                    <div id="fileName" class="fw-semibold"></div>
                    <div id="fileSize" class="text-secondary small"></div>
                </div>
            </div>

            <div class="actions">
                <button id="submitBtn" class="btn btn-primary btn-lg" type="submit" disabled>분석하기</button>
                <a class="btn btn-outline-secondary btn-lg" th:href="@{/events/search}">검색하기</a>
            </div>

            <div th:if="${error}" class="alert alert-danger mt-3" th:text="${error}"></div>
        </form>
    </div>
</div>

<script th:src="@{/js/bootstrap.bundle.min.js}"></script>
<script>
    const fileInput = document.getElementById('imageFile');
    const submitBtn = document.getElementById('submitBtn');
    const previewBox = document.getElementById('preview');
    const previewImg = document.getElementById('previewImg');
    const fileName = document.getElementById('fileName');
    const fileSize = document.getElementById('fileSize');

    fileInput.addEventListener('change', (e) => {
      const f = e.target.files && e.target.files[0];
      if (!f) { submitBtn.disabled = true; previewBox.style.display='none'; return; }
      submitBtn.disabled = false;
      fileName.textContent = f.name;
      fileSize.textContent = (f.size/1024/1024).toFixed(2) + ' MB';
      const reader = new FileReader();
      reader.onload = ev => { previewImg.src = ev.target.result; previewBox.style.display='flex'; };
      reader.readAsDataURL(f);
    });
</script>
</body>
</html>
